<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta charset="utf-8">
    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
    <script src="https://code.jquery.com/jquery-latest.min.js"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <script src="https://kit.fontawesome.com/c9fd3db041.js" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/1.3.4/jspdf.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.4.3/jspdf.plugin.autotable.min.js"></script>


    <title>Embraer App</title>
    <link rel="icon" href="https://companieslogo.com/img/orig/ERJ-dcd6dcae.png?t=1593008465">
  </head>

  <body>
  <div class="logo-container p-3 d-flex justify-content-between">
    <a href="index.html"><i class="fa-solid fa-house mt-2"></i></a>
    <img src="logo.embraer.png">
    <div>
      <i class="fa-solid fa-bell"></i>
      <i class="fa-solid fa-user mt-2"></i>
    </div>
  </div>

    <style>
       ::-webkit-scrollbar{
          width: 15px;
       }
       ::-webkit-scrollbar-track{
          background: Gainsboro;
          border-radius: 30px;
       }
       ::-webkit-scrollbar-thumb{
          background: rgb(11, 27, 91);
          border-radius: 30px;
       }
       .bg-primary2 {
          background-color: rgb(11, 27, 91);
       }
       .btn-primary {
          color: #fff;
          background-color: rgb(11, 27, 91);
          border-color: #fff;
       }
       .logo-container {
          background-color: rgb(11, 27, 91);
          color: #FFF;
       }

       .btn-secondary {
          background-color: rgb(11, 27, 91);
       }
       .dropdown-item.active {
          background-color: #007bff;
          color: #fff;
       }
       .fa-solid {
          margin-right: 20px;
          margin-left: 20px;
       }
       .custom-select-width{
          width: 150px;
       }

    </style>

    <div id="app"></div>
    <script>

      new Vue({
        
        el: "#app",
        template:`

        <div class="container">
      <div class="row mt-5 justify-content-center">
        <div class="col-md-8">
          <div class="card shadow">
            <div class="card-header bg-primary2 text-white">
              <h5 class="font-weight-bold mb-0">CONSULTATION</h5>
            </div>
            <div class="card-body">
              <div class="form-group">
                <label for="chassi" class="font-weight-bold">Chassi:</label>
                <div class="input-group">
                  <select v-model="idChassi" id="select-chassi" class="form-select form-select-sm custom-select-width">
                    <option v-for="option in chassiOptions" :value="option.idChassi" :key="option.idChassi">{{ option.idChassi }}</option>
                  </select>
                  <div class="input-group-append">
                    <button @click="search" class="btn btn-primary " type="button" style="margin-left: 5px;">Search</button>
                  </div>
                </div>
              </div>
                <div class="d-flex justify-content-between" style="margin-top: 8px;">
                    <div class="w-50">
                        <select class="form-select form-select-sm custom-select-width" aria-label=".form-select-lg example" @change="onSelectChange">
                            <option selected>Category</option>
                            <option v-for="(cat, index) in category" :value="index" :key="index">{{ cat }}</option>
                        </select>
                    </div>
                    <div class="w-50 d-flex justify-content-end">
                        <div class="form-check form-switch">
                            <input class="form-check-input" type="checkbox" id="switch-yes" v-model="checkedYes">
                            <label class="form-check-label" for="switch-yes">✔</label>
                        </div>
                        <div class="form-check form-switch ms-3">
                            <input class="form-check-input" type="checkbox" id="switch-no" v-model="checkedNo">
                            <label class="form-check-label" for="switch-no">❌</label>
                        </div>
                    </div>
                </div>
                <div class="d-flex justify-content-end">
                    <button onclick="exportarPDF()" class="btn btn-primary btn-sm " type="button" style="margin-top: 10px">Generate PDF</button>
                </div>
              <div class="table-responsive">
                <table class="table table-bordered table-striped mt-4" id="table-1">
                  <thead id="table-1" class="bg-primary2 text-white">
                    <tr>
                      <th class="text-center">Item</th>
                      <th class="text-center">Installed</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr v-for="(nome,index) in nomes" :key="nomes.idItem" v-if="(checkedYes && nome.status === '✔') || (checkedNo && nome.status === '❌') || (!checkedYes && !checkedNo)">
                      <td class="text-center">{{ nomes[index].nome }}</td>
                      <td class="text-center">{{ nomes[index].status }}</td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
        `,

        data: {

          items: [
            { id: 1, name: "Item 1"  , yes: "Yes", no: "No" },
            { id: 2, name: "Item 2", yes: "Yes", no: "No" },
            { id: 3, name: "Item 3", yes: "Yes", no: "No" },
          ],
          nomes:[],
          category:[],
          idChassi: null,
          checkedYes: false,
          checkedNo: false,
          idChassi: '',
          chassiOptions: []
        },
        mounted() {
          axios.get('http://localhost:8080/chassi')
            .then(response => {
              this.chassiOptions = response.data;
            })
            .catch(error => {
              console.log(error);
            });
        },
        methods: {
          search() {
            axios
              .get('http://localhost:8080/logica?idChassi=' + this.idChassi)
              .then(response => {
                this.nomes = response.data;
                console.log(response.data)
              })
              .catch(error => {
                console.error(error);
              });

              axios
              .get('http://localhost:8080/item/category')
              .then(response => {
                this.category = response.data;
                console.log(response.data)
              })
              .catch(error => {
                console.error(error);
              });
          },

          downloadPdf() {
            const element = document.getElementById("pdf"); // seleciona o elemento a ser convertido
            const opt = {
              margin:       1,
              filename:     'test.pdf',
              image:        { type: 'jpeg', quality: 1 },
              html2canvas:  { scale: 2 },
              jsPDF:        { unit: 'in', format: 'letter', orientation: 'portrait' }
            };

            html2pdf().from(element).set(opt).save();
          },
          onSelectChange(event) {
            this.nomes = [];
                // Método que será chamado quando uma opção for selecionada
            const selectedIndex = parseInt(event.target.value); // Converte o valor para inteiro
            console.log(selectedIndex)
            let selectedText = this.category[selectedIndex]; // Obtém o texto do item selecionado
            // Faça o que desejar com o texto selecionado, por exemplo:
            console.log("Texto selecionado:", selectedText);  

            if(selectedText===undefined){
              selectedText = "all"
            }

            
            axios
              .get('http://localhost:8080/logicaByCategory?idChassi=' + this.idChassi +'&category='+selectedText)
              .then(response => {
                this.nomes = response.data;
                console.log(response.data)
              })
              .catch(error => {
                console.error(error);
              });
          }
        }
      });
    </script>
  <script>
    function exportarPDF() {
      // Crie uma nova instância da biblioteca jsPDF
      var doc = new jsPDF();
      var imgData = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAEACAMAAABrrFhUAAAAM1BMVEUAAAAARJwARJwARJwARJwARJwARJwARJwARJwARJwARJwARJwARJwARJwARJwARJwARJypp4XDAAAAEHRSTlMAECAwQFBgcICPn6+/z9/vIxqCigAAA0VJREFUeNrswQENAAAAATD6l9bD/gcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB+deSah3brIAxAxQghDhj9/9d2YCyGMtRxlu6b5cQU3coSJvEEKMRlPNlAH5eCJ9mAOm5I7PriNxmJ4kAbvmCHvviv2BPUpf8de6LK7qe4AYaCPQmUsSGhcANgMw4Uq7D7Kd4ARJwIyrqf7vjdjoTCBhhw5q4q/TecyUZj9yOK0Xb0obgBRlzx72VOnAg0dIED30YshOnVjpvDw3TldZ6ImZBmFGMSEsIG6HEi0dAOBztJTUyh8Tiz22Nl5byQ+UHxE8qfXV3BlRv8VgBJDOt6+QuIbQo4CQSgFR99cAv4tQBKgfxivYyAQglQCQIBV2n3W8kgElAScTuGaNk1vr1bb2rUIMY56v1C8e75+28ayIlwkIYh8T3gMhu/kQlIzNDWll2XuMVOADTy9+A4h6kCzgTwppwu41qd0zAU3xVg/DehIMfVczwWkD3hDgH2SNEjAWwvoL22FgczCiBH8RiPp8s4r85MAvybAkxGOaIakGCr/xwJAPFZEVwzgBKgdZHA1gBhBlD8/y/Adjc42ocCsgOmBiSAZrC1kZ0VwNWAiyD+/xNwBLDd61PV4wwoZpzjiKEJpI1EfLML5H+KH2U1oEXQwuBqgP8eDIuAshmAbTXF14CJ/DwBxv3kHVlukUPWBaALIcEoYHxpZDdCdh2MfBdYsOITcPk5wBjCHolwCqAY/CQgNvIpgGpAphq6pECsHZWwUw046qYAtws2gqIaQCmQYBAwE8cssl0XTWmILL7sAjexADDsbRD+RIBrq3wqwI0CgPZR23RcVW5vtUEPMq4CAzIBkOi/DwVswAgoy82caVgoQP5ewHocIj8PqAJd/KTO5PnH9+iALqh0U3W4uEATVlP0XaSYxBvQfSSUjbLPQ2k3YDPXDFWxqTewbguD5o/G0JOl5vfHPtq3bwMIoRgKYP4Xyey/Lb2pqZ40hLPPd955XOaBSO+Okm+Ee1m4V5wpOxneu6O54oy9lQN55tZ25/me0eVA747OUXnGEl0O9O5oqyauLFw8TgIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACPuAB6cK6WWhyiSwAAAABJRU5ErkJggg==';
      var img = new Image();
      img.src = imgData;
      doc.addImage(img, 'PNG', 163, 0, 35, 35);

      // Obtem o número do chassi selecionado
      var chassi = document.getElementById('select-chassi').value;

      // Adiciona o texto e o número do chassi ao documento PDF
      doc.setFont('helvetica', 'bold');
      doc.setFontSize(12).text('Chassi: ' +chassi+ ' - Installed Items Report', 66, 20);
      doc.setLineWidth(0.5);
      doc.line(14, 23, 196, 23); //
      // Define as configurações da tabela
      var table = document.getElementById('table-1');
      var rows = table.getElementsByTagName('tr');

      // Cria uma matriz para armazenar os dados da tabela
      var data = [];
      // Preenche a matriz com os dados da tabela
      for (var i = 1; i < rows.length; i++) {
        var row = [], cols = rows[i].querySelectorAll('td, th');
        for (var j = 0; j < cols.length; j++) {
            var text = cols[j].innerText;
            text = text.replace(/✔/g, 'Yes').replace(/❌/g, 'No');
            row.push(text);
        }
        data.push(row);
      }

      // Define as configurações do documento PDF
      var header = ['Item', 'Installed'];
      doc.autoTable({
        head: [header],
        body: data,
        margin: { top: 30 },
        headStyles: {
          fillColor: [11, 27, 91],
          textColor: [255, 255, 255],
        },
        startY: 30,
        margin: {top: 40},
      });

      // Adiciona um texto no rodapé do PDF com a data e hora atual
      var now = new Date();
      var dateTime = now.toLocaleString();
      var pageCount = doc.internal.getNumberOfPages(); // obtem o número total de páginas
      for (var i = 1; i <= pageCount; i++) {
        doc.setPage(i);
        var y = doc.internal.pageSize.height - 10; // define a posição vertical do texto (10 mm do fundo da página)
        doc.setFontSize(8);
        doc.text('Generated on: ' +dateTime+ ' - Developed By CarcaraTec', doc.internal.pageSize.width / 2, y, 'center'); // define a posição horizontal do texto (centro da página)
      }

      // Faz o download do arquivo PDF
      doc.save('relatório.pdf');
    }

  </script>
</body>
</html>
